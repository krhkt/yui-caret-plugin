YUI.add("caret-plugin",function(d){var c,b,a=d.Lang;c={isValidNode:function(e){return e&&((e.nodeName.toLowerCase()==="textarea")||((e.nodeName.toLowerCase()==="input")&&(["radio","checkbox","submit","file","hidden","reset","button","image","range"].indexOf(e.getAttribute("type")||e.type)===-1)))},getSelection:function(f,g){var e=-1,h={};if(!f.setSelectionRange&&document.selection){if(!f.ownerDocument.selection||!f.ownerDocument.selection.createRange){d.log("The caret-plugin does not support this browser.","error","selection-control");return e}h.oRange=f.ownerDocument.selection.createRange();if(f!==h.oRange.parentElement()){return e}h.unit="character";h.isInput=(f.nodeName.toLowerCase()==="input");h.helperRange=h.oRange.duplicate();h.helperRange.collapse(g!==-1);if(h.isInput){e=-h.helperRange.moveStart(h.unit,(-1*f.value.length))}else{for(e=-1;h.helperRange.parentElement()===f;e+=1){h.helperRange.moveStart(h.unit,-1)}}if((g===1)||(g===-1)){return e}e={start:e};h.helperRange=h.oRange.duplicate();h.helperRange.collapse(false);if(h.isInput){e.end=-h.helperRange.moveStart(h.unit,(-1*f.value.length))}else{for(e.end=-1;h.helperRange.parentElement()===f;e.end+=1){h.helperRange.moveStart(h.unit,-1)}}}else{if(g===-1){return(f.selectionEnd===undefined)?0:f.selectionEnd}else{if(g===1){return(f.selectionStart===undefined)?0:f.selectionStart}else{e={start:(f.selectionEnd===undefined)?0:f.selectionStart,end:(f.selectionStart===undefined)?0:f.selectionEnd}}}}return e},setSelection:function(f,e,h){var g;if(e!==undefined){h=h?h:e}else{e=0;h=f.value.length}if(f.setSelectionRange){f.focus();f.setSelectionRange(e,h)}else{if(f.createTextRange){f.focus();g=f.createTextRange();g.collapse(true);g.moveEnd("character",h);g.moveStart("character",e);g.select()}else{f.select()}}return f},getSelectedContent:function(g){var f,e=this.getSelection(g);if(e===-1){return""}f=g.value;if((f.indexOf("\r\n")!==-1)&&(document.selection!==undefined)){f=f.replace(/\r\n/g,"\n")}return f.substring(e.start,e.end)}};b=d.Base.create("caret",d.Plugin.Base,[],{_DOMNode:null,initializer:function(){this._DOMNode=this.get("host").getDOMNode()},isValidNode:function(){return c.isValidNode(this._DOMNode)},insert:function(e){this.set("content",e);this.set("position",this.get("selectionEnd"))},clearSelection:function(){c.setSelection(this._DOMNode,0,0)},selectAll:function(){c.setSelection(this._DOMNode)}},{NS:"caret",ATTRS:{selectionStart:{lazyAdd:false,value:null,getter:function(){if(!this.isValidNode()){return 0}return c.getSelection(this._DOMNode,1)},setter:function(f){var e;if((f===null)||!this.isValidNode()){return}e=c.getSelection(this._DOMNode,-1);if(f>e){e=f}c.setSelection(this._DOMNode,f,e);return f},validator:function(e){return(a.isNumber(e))&&(e>=0)&&(e<this.get("host").get("value").length)}},selectionEnd:{lazyAdd:false,value:null,getter:function(){if(!this.isValidNode()){return 0}return c.getSelection(this._DOMNode,-1)},setter:function(e){var f;if((e===null)||!this.isValidNode()){return}f=c.getSelection(this._DOMNode,1);if(e<f){f=e}c.setSelection(this._DOMNode,f,e);return e},validator:function(e){return(a.isNumber(e))&&(e>=0)&&(e<this.get("host").get("value").length)}},range:{lazyAdd:false,value:null,getter:function(){if(!this.isValidNode()){return null}return c.getSelection(this._DOMNode,0)},setter:function(e){if((e===null)||!this.isValidNode()){return}c.setSelection(this._DOMNode,e.start,e.end)}},position:{lazyAdd:false,value:null,getter:function(){if(!this.isValidNode()){return null}return c.getSelection(this._DOMNode,1)},setter:function(e){if((e===null)||!this.isValidNode()){return}c.setSelection(this._DOMNode,e,e)}},content:{lazyAdd:false,value:null,getter:function(){if(!this.isValidNode()){return null}return c.getSelectedContent(this._DOMNode)},setter:function(e){var f,h,g;if((e===null)||!this.isValidNode()){return}e=a.isUndefined(e)?"":e.toString();f=c.getSelection(this._DOMNode,0);h=this.get("host").get("value");g=h.substring(0,f.start)+e+h.substring(f.end);this.get("host").set("value",g);f.end=f.start+e.length;c.setSelection(this._DOMNode,f.start,f.end)}}}});d.Plugin.Caret=b},"1.0",{requires:["node","base","plugin"]});
